{% extends 'base.html' %}

{% block content %}

{% load static %}
 <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
  />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src=
"https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js">
  </script>
<script src=
https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js
">
  </script>
<!-- Image and text -->
<div class="alert alert-info alert-dismissible fade byebye" role="alert" id="toast">

<i class="bi bi-app-indicator"></i>
   <strong>Install as app.</strong> If you are on safari, press the share button, and then click "Add to home screen"
  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>

</div>
<div class="dropdown">
  <a class=" text-secondary display-6" id="settings" type="button" data-bs-toggle="dropdown" aria-expanded="false">
   
<i class="bi bi-list"></i>

  </a>
  <ul class="dropdown-menu">
    <li><a class="dropdown-item" onclick="clearCacheAndReload()"id="update">Update</a></li>
    <li><a class="dropdown-item" href="#">Another action</a></li>
    <li><a class="dropdown-item" href="#">Something else here</a></li>
  </ul>
</div>
<h2 class="text-center pt-5 fw-bold display-4">Hello {{user.username}}, Start memorizing bible verses</h2>
<div class=" text-center container-fluid  p-5 ">

<hr class="rounded">
<h1>Verse of The day</h1>

<p id="sentence" class="lead"></p>

<span class="ml-2 spinner-border spinner-grow mx-auto m-5" style="width: 3rem; height: 3rem;"role="status" id="mySpinner"></span>
<button id="incrementButton" class="btn btn-primary">Hide</button>
<button id="finishButton" class="btn btn-primary">Finish</button>
</div>

 <div class="container p-5 mx-auto">
   <h1 data-aos="zoom-in" class="p-5 text-center  ">Find the perfect road for you</h1>
<div class="d-flex align-items-center justify-content-center input-group">

     <span class="input-group-text bg-primary" id="basic-addon1"><i class="bi bi-search"></i></span>
<input class="form-control"type="text" id="searchInput" placeholder="Search all Roads...">

  </div>
<ul style="list-style: none;"class="text-center fs-3" id="searchResults"></ul>
   <h1 class="animate__animated animate__shakeY text-center animate__infinite animate__slower animate__delay-5s"><i class="bi bi-arrow-bar-down"></i></h1>
<div id="romans-road" data-aos="fade-right" class="card mx-auto m-5" style="width: 18rem;">
     <img src="{% static 'RomansRoad.png' %}" class="card-img-top" alt="...">
  <div class="card-body">
    <h5 class="card-title">The Romans Road</h5>
    <p class="card-text">The Romans Road is a short collection of verses in the book of Romans that explain the basics of salvation. </p>
    
  <a class=" btn btn-primary" href="{% url 'romans' %}">Start memorizing</a>
  </div>
</div>
<div id="vacation-verses" data-aos="fade-left" class="card mx-auto m-5" style="width: 18rem;">
  <img src="{% static 'Psalm100.png' %}" class="card-img-top" alt="...">
  <div class="card-body">
    <h5 class="card-title">Psalm 100</h5>
       <p class="card-text">Psalm 100 is a Psalm of David worshipping and praising the lord for all the things he has done for him.</p>
    
  <a class=" btn btn-primary" href="{% url 'Psalm100' %}">Start memorizing</a>
  </div>
</div>
<div id="Psalm23" data-aos="fade-right" class="card mx-auto m-5" style="width: 18rem;">
     <img src="{% static 'Psalm23.png' %}" class="card-img-top" alt="...">
  <div class="card-body">
    <h5 class="card-title">Psalm 23</h5>
    <p class="card-text">Psalm 23 is one of the most commonly memorized verses. It talks about God being with, and comforting someone wherever they go.</p>
    
  <a class=" btn btn-primary" href="{% url 'Psalm23' %}">Start memorizing</a>
  </div>
</div>
<div id="Verses to live by" data-aos="fade-right" class="card mx-auto m-5" style="width: 18rem;">
     <img src="{% static 'versestlb.png' %}" class="card-img-top" alt="...">
  <div class="card-body">
    <h5 class="card-title">Verses to live by.</h5>
    <p class="card-text">A small collection of verses that anyone can memorize.</p>
    
  <a class=" btn btn-primary" href="{% url 'Versestoliveby' %}">Start memorizing</a>
  </div>
</div>

</div>
<style>
html {

}
nav{
  margin:0;
}
.hide-word {
         
        color: transparent;
        text-shadow: 0 0 13px #000;
}

  body {
    padding-bottom: 40px;
    
     
  }

hr.rounded {
  border-top: 8px solid #bbb;
  border-radius: 5px;
}
.gradient {
/*
* Created with https://www.css-gradient.com
* Gradient link: https://www.css-gradient.com/?c1=f312a1&c2=95a759&gt=r&gd=dtl
*/
      background-image: linear-gradient(to bottom, #ff0000, #00ff00)
}
.byebye {
  display: none
}
.hihi {
  display: block
}
</style>
<script>
const url = "https://beta.ourmanna.com/api/v1/get";

  const xhr = new XMLHttpRequest();
  xhr.open("GET", url);
  xhr.responseType = "text";

  // Show the spinner before making the request
  document.getElementById("mySpinner").style.display = "block";

  xhr.onload = function() {
    if (xhr.status === 200) {
      const text = xhr.responseText;
      document.getElementById("sentence").innerHTML = text;

      // Hide the spinner and show the content once it is loaded
      document.getElementById("mySpinner").style.display = "none";
      document.getElementById("sentence").style.display = "block";
    } else {
      console.log("Error: " + xhr.status);
    }
  };

  xhr.send();
const arrayOfStrings = [
    "Psalm100",
    "romans-road",
    "Psalm23",
    "Verses to live by",
    
  ];
function clearCacheAndReload() {
    
    console.log('Clicked on "Update" link');
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(function (registrations) {
        for (let registration of registrations) {
          registration.unregister();
        }
        window.location.reload();
      }).catch(function (error) {
        console.error('Error clearing service worker cache:', error);
      });
    }
  }

function revealAllWords() {
  var currentSentence = sentence;
  var words = currentSentence.getElementsByTagName("span");

  for (var i = 0; i < words.length; i++) {
    words[i].classList.remove("hide-word");
  }

  incrementButton.disabled = false;
}
  function searchArray() {
    const searchInput = document.getElementById("searchInput").value.toLowerCase();
    const searchResults = [];

    for (let i = 0; i < arrayOfStrings.length; i++) {
      if (arrayOfStrings[i].toLowerCase().includes(searchInput)) {
        searchResults.push(arrayOfStrings[i]);
      }
    }

    const resultContainer = document.getElementById("searchResults");
    resultContainer.innerHTML = "";

    if (searchResults.length > 0) {
      for (let i = 0; i < searchResults.length; i++) {
        const listItem = document.createElement("li");
        const link = document.createElement("a");
        link.href = "#" + searchResults[i];
        link.textContent = searchResults[i];
    'whitenoise.middleware.WhiteNoiseMiddleware',
        listItem.appendChild(link);
        resultContainer.appendChild(listItem);
      }
    } else {
      const noResultsItem = document.createElement("li");
      noResultsItem.textContent = "No results found.";
      resultContainer.appendChild(noResultsItem);
    }
  }

  function activateTopItem() {
    const topItem = document.querySelector("#searchResults li:first-child a");
    if (topItem) {
      window.location.hash = topItem.getAttribute("href");
    }
  }

  document.getElementById("searchInput").addEventListener("keyup", function (event) {
    if (event.key === "Enter") {
      activateTopItem();
    } else {
      searchArray();
    }
  });var hiddenWordIndices = [];
function hideRandomWords(numWords) {
  var sentence = document.getElementById("sentence");

  var sentenceText = sentence.textContent;

  var words = sentenceText.split(" ");

  var visibleWordIndices = words
    .map(function (_, index) {
      return index;
    })
    .filter(function (index) {
      return hiddenWordIndices.indexOf(index) === -1;
    });

  if (visibleWordIndices.length === 0) {
    console.log("No visible words left to hide.");
    return;
  }

  var randomIndices = [];
  while (randomIndices.length < numWords && visibleWordIndices.length > 0) {
    var randomIndex = Math.floor(Math.random() * visibleWordIndices.length);
    var randomVisibleIndex = visibleWordIndices[randomIndex];
    randomIndices.push(randomVisibleIndex);
    visibleWordIndices.splice(randomIndex, 1);
  }

  hiddenWordIndices = hiddenWordIndices.concat(randomIndices);

  for (var i = 0; i < words.length; i++) {
    if (hiddenWordIndices.indexOf(i) !== -1) {
      words[i] = '<span class="hide-word">' + words[i] + "</span>";
    }
  }
  sentence.innerHTML = words.join(" ");

  console.log("Total Hidden Words: " + hiddenWordIndices.length);

  if (hiddenWordIndices.length === words.length) {
    document.getElementById("incrementButton").disabled = true;
  }
}
function handleButtonClick() {
  hideRandomWords(3);
}

var button = document.getElementById("incrementButton");
button.addEventListener("click", handleButtonClick);

function handleFinishButtonClick() {
  hideRandomWords(Number.MAX_SAFE_INTEGER);
}

var finishButton = document.getElementById("finishButton");
var clickCounter = 0;
var isHidden = false;

// Remove the extra closing brace on line 287
finishButton.addEventListener('click', function () {
  if (!isHidden) {
    hideRandomWords(Number.MAX_SAFE_INTEGER);
    isHidden = true;
    hideButton.disabled = true;
  } else {
    swal({
      title: "Are you sure?",
      text: "You are about to unhide all the words. Are you sure you want to do this?",
      icon: "info",
      buttons: ["Cancel", "Yes"],
      closeOnClickOutside: false,
    }).then(function (result) {
      if (result) {
        revealAllWords();
        hiddenWordIndices = []; // Clear the index cache
        isHidden = false;
        hideButton.disabled = false;
      }
    });
  }
}, true);

function isIOS() {
  // Get the user agent string.
  var userAgent = navigator.userAgent;

  // Check if the user agent contains any of the following strings.
  var isIOS = /iPad|iPhone|iPod/.test(userAgent);

  // Return true if the user is on iOS, false otherwise.
  return isIOS;
}
  function showToast() {
      // Get the toast element.
      var toast = document.getElementById('toast');
      
      
      toast.classList.replace('byebye','show');
      // Show the toast.
    }
function isPWA() {
  // Get the user agent string.

  if (window.matchMedia('(display-mode: standalone)').matches) {  

     return isPWA;
  }
}
// Check if the user is on iOS and not on the PWA.
if (isIOS() && !isPWA()) {
  showToast();
}
</script>
<script src="https://unpkg.com/aos@next/dist/aos.js"></script>
  <script>
    AOS.init();
  </script>
</body>
{% endblock %}
