
{% extends 'base.html' %}

{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<script src=
"https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js">
</script>
<nav class="navbar navbar-expand-sm">
  <div class="container-fluid">
    <a class=" link-text display-5" style="color: #adb5b1" href ="{% url "dashboard" %}"><i class="bi bi-caret-left-fill "></i></a>
  
    <span class="navbar-text"><i class="bi bi-book-fill display-6" style="color: #adb5b1"></i></span>
  </div>
</nav>
<div class="text-center card mx-auto p-1 " style="width:80vw; background-color: #343A40; border-color:  #343A40; font-size: 24px">
<div class="card-body">
<p id="sentence">Lift up a great shout of joy to Yahweh!
Go ahead and do it—everyone, everywhere!
</p><p id="sentence2">Worship Yahweh with gladness.
Sing your way into his presence with joy!
</p><p id="sentence3">And realize what this really means—
we have the privilege of worshiping Yahweh our God.
For he is our Creator and we belong to him.
We are the people of his pleasure. 
</p><p id="sentence4">You can pass through his open gates  with the password of praise.
Come right into his presence with thanksgiving.
Come bring your thank offering to him
and affectionately bless his beautiful name!
</p><p id="sentence5">or Yahweh is always good and ready to receive you.
He’s so loving that it will amaze you—
so kind that it will astound you!
And he is famous for his faithfulness toward all.
Everyone knows our God can be trusted,
for he keeps his promises to every generation!
</p>
</div>
</div>
<div class="mx-auto text-center p-5">
<button id="incrementButton" class="btn btn-primary mb-2">Hide More</button>
<button id="finishButton" class="btn btn-primary mb-2">Finish Verse</button>

<button id="nextButton" class="btn btn-primary mb-2">Next Verse</button>

</div>
<div class="progress-container">
<div class="progress">
  <div id="progressBar" class="progress-bar lrm-5" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
</div>
</div>
</div>
<style>
nav{
  margin:0;
}
.hide-word {
         
        color: transparent;
        text-shadow: 0 0 13px #000;
}
  html,
  body {
    overflowX: hidden;
  }

  body {
    padding-bottom: 40px;
    
    overflow-x: hidden;
  }
hr.rounded {
  border-top: 8px solid #bbb;
  border-radius: 5px;
}
.progress-container {
  padding: 0 15vw; /* Adjust the padding as needed */
  max-width: 600vw; /* Set a maximum width for the progress bar container */
  margin: 0 auto; /* Center the container on the screen */
}
</style>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>

  var sentences = document.querySelectorAll("p[id^='sentence']");
  var currentSentenceIndex = 0;
  var hiddenWordIndices = [];
  // Other JavaScript code...

  // Function to save the user's progress using AJAX
  function saveUserProgress() {
    var currentSentence = sentences[currentSentenceIndex];
    var sentenceText = currentSentence.textContent;
    var data = {
      current_sentence_index: currentSentenceIndex,
      hidden_word_indices: hiddenWordIndices.join(","),
    };

    $.ajax({
      type: "POST",
      url: "{% url 'save_progress' %}",
      data: data,
      dataType: "json",
      success: function (response) {
        // Handle success if needed
        console.log("User progress saved successfully!");
      },
      error: function (xhr, textStatus, errorThrown) {
        // Handle error if needed
        console.error("Error saving user progress:", errorThrown);
      }
    });
  }

  // Function to retrieve the user's progress using AJAX
  function loadUserProgress() {
    $.ajax({
      type: "GET",
      url: "{% url 'get_progress' %}",
      dataType: "json",
      success: function (data) {
        if (data) {
          currentSentenceIndex = data.current_sentence_index;
          hiddenWordIndices = data.hidden_word_indices.split(",").map(Number);

          // Restore the progress on the page
          // Update the display and enable/disable buttons as needed
          // ...
        }
      },
      error: function (xhr, textStatus, errorThrown) {
        // Handle error if needed
        console.error("Error loading user progress:", errorThrown);
      }
    });
  }

  // Other JavaScript code...

  // Call this function when the page loads
  $(document).ready(function() {
    loadUserProgress();
  });

  // Call this function when the user makes progress and you want to save it
  function handleProgressChange() {
    saveUserProgress();
    // Update the display and enable/disable buttons as needed
    // ...
  }
var sentences = document.querySelectorAll("p[id^='sentence']");
var currentSentenceIndex = 0;
var hiddenWordIndices = [];
var hideButton = document.getElementById("incrementButton"); // Get the hide button element
var nextButton = document.getElementById("nextButton"); // Get the next button element
var finishButton = document.getElementById("finishButton"); // Get the finish button element
var progressBar = document.getElementById("progressBar"); // Get the progress bar element

hideButton.addEventListener('click', function () {
  hideRandomWords(3);
}, true);

nextButton.addEventListener('click', function () {
  moveToNextSentence();
}, true);

var finishButtonClicks = 0; // Variable to track the number of finish button clicks

finishButton.addEventListener('click', function () {
  finishButtonClicks++;
  if (finishButtonClicks === 1) {
    hideAllWords();
  } else if (finishButtonClicks === 2) {
    revealAllWords();
    finishButtonClicks = 0; // Reset the click counter
  }
}, true);

function hideRandomWords(numWords) {
  var currentSentence = sentences[currentSentenceIndex];
  var sentenceText = currentSentence.textContent;

  var words = sentenceText.split(" ");

  var visibleWordIndices = words
    .map(function (_, index) {
      return index;
    })
    .filter(function (index) {
      return hiddenWordIndices.indexOf(index) === -1;
    });

  if (visibleWordIndices.length === 0) {
    console.log("No visible words left to hide.");
    hideButton.disabled = true; // Disable the hide button if there are no visible words
    return;
  }

  // Adjust numWords to ensure it doesn't exceed the number of visible words
  numWords = Math.min(numWords, visibleWordIndices.length);

  var randomIndices = [];
  while (randomIndices.length < numWords && visibleWordIndices.length > 0) {
    var randomIndex = Math.floor(Math.random() * visibleWordIndices.length);
    var randomVisibleIndex = visibleWordIndices[randomIndex];
    randomIndices.push(randomVisibleIndex);
    visibleWordIndices.splice(randomIndex, 1);
  }

  hiddenWordIndices = hiddenWordIndices.concat(randomIndices);

  for (var i = 0; i < words.length; i++) {
    if (hiddenWordIndices.indexOf(i) !== -1) {
      words[i] = '<span class="hide-word">' + words[i] + "</span>";
    }
  }

  currentSentence.innerHTML = words.join(" ");

  console.log("Total Hidden Words in Sentence " + (currentSentenceIndex + 1) + ": " + hiddenWordIndices.length);

  if (hiddenWordIndices.length === words.length) {
    hideButton.disabled = true;
  }
}

function hideAllWords() {
  var currentSentence = sentences[currentSentenceIndex];
  var words = currentSentence.textContent.split(" ");

  hiddenWordIndices = [];
  for (var i = 0; i < words.length; i++) {
    hiddenWordIndices.push(i);
    words[i] = '<span class="hide-word">' + words[i] + "</span>";
  }

  currentSentence.innerHTML = words.join(" ");
  hideButton.disabled = true;
}

function revealAllWords() {
  var currentSentence = sentences[currentSentenceIndex];
  var words = currentSentence.getElementsByTagName("span");

  for (var i = 0; i < words.length; i++) {
    words[i].classList.remove("hide-word");
  }

  hideButton.disabled = false;
}

function moveToNextSentence() {
  currentSentenceIndex++;

  if (currentSentenceIndex >= sentences.length) {
    console.log("You have finished all the sentences.");
    hideButton.disabled = true;
    nextButton.disabled = true;
    swal("You Finished this road!", {
    title:"Good job!",
    icon:"success",
    buttons: {
    catch: {
      text: "Back to dashboard",
      value: "catch",
    },
      text : "try again",
  },
})
.then((value) => {
  switch (value) {
 
    
 
    case "catch":
      window.location.href = "{% url 'dashboard' %}";
      break;
 
    default:

    location.reload();
  }
});    finishButton.disabled = true;
    return;
  }
   

  // Reset hiddenWordIndices array and enable the buttons
  hiddenWordIndices = [];
  hideButton.disabled = false;
  nextButton.disabled = false;
  finishButton.disabled = false;

  // Hide the current sentence
  var currentSentence = sentences[currentSentenceIndex - 1];
  currentSentence.style.display = "none";

  // Show the next sentence
  var nextSentence = sentences[currentSentenceIndex];
  nextSentence.style.display = "block";
  
  // Update the progress bar
  var progressWidth = ((currentSentenceIndex + 1) / sentences.length) * 100;
  progressBar.style.width = progressWidth + "%";
  progressBar.setAttribute("aria-valuenow", progressWidth);
}
  

// Hide all sentences except the first one
for (var i = 1; i < sentences.length; i++) {
  sentences[i].style.display = "none";
}</script>
{% endblock %}
